<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>1-4</storyId>
    <title>View Course List</title>
    <status>drafted</status>
    <generatedAt>2025-12-01</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/epic-1/story-1-4/1-4-view-course-list.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>student</asA>
    <iWant>to view a list of all my created courses</iWant>
    <soThat>I can easily navigate to a specific course.</soThat>
    <tasks>
### Frontend Tasks
- [ ] **Update API Client** (AC: 1.4.1)
  - Add `getCourses` function to `frontend/lib/api.ts`.
  - Call `GET /api/v1/courses` with `Authorization` header.
  - Ensure strict typing for the return value (`Course[]`).
- [ ] **Implement Course List UI** (AC: 1.4.2, 1.4.3)
  - Create/Update `frontend/app/dashboard/page.tsx` to fetch courses on load (using `useEffect` or React Query if available).
  - Display courses using a grid or list layout.
  - Handle "Loading" and "Empty" states.
  - Link each card to `/dashboard/courses/{course_id}`.

### Backend Tasks
- [ ] **Implement Get Courses Endpoint** (AC: 1.4.1)
  - Add `GET /api/v1/courses` endpoint in `backend/app/api/routers/courses.py`.
  - Use `deps.get_current_user` to authenticate.
  - Query `courses` table for records where `user_id == current_user.id`.
  - Return list of courses (Pydantic model `list[Course]`).
- [ ] **Verify RLS for Select** (AC: 1.4.1)
  - Verify existing RLS policy on `courses` table allows `SELECT` for owner. (Created in Story 1-3).

### Testing Tasks
- [ ] **Backend Integration Tests** (AC: 1.4.1)
  - Test `GET /api/v1/courses` returns user's courses.
  - Test `GET /api/v1/courses` returns empty list if no courses.
  - Test `GET /api/v1/courses` returns 401 if unauthenticated.
- [ ] **Frontend Manual Verification** (AC: 1.4.2, 1.4.3)
  - Verify Dashboard loads courses (Happy Path).
  - Verify "No courses found" empty state (Empty Path).
  - Verify clicking a course navigates to `/dashboard/courses/[id]`.
</tasks>
  </story>

  <acceptanceCriteria>
### AC 1.4.1: Fetch Course List
- [ ] The system retrieves all courses associated with the currently logged-in user from the database.
- [ ] The list is ordered by creation date (newest first) or name (alphabetical), as per default UI preference.

### AC 1.4.2: Display Courses on Dashboard
- [ ] The dashboard displays the list of courses.
- [ ] If no courses exist, a friendly "No courses found" message or empty state is shown (encouraging creation).
- [ ] Each course card/item displays at least the Course Name.

### AC 1.4.3: Course Navigation
- [ ] Each course entry in the list is clickable.
- [ ] Clicking a course navigates the user to the Course Details page (e.g., `/dashboard/courses/[id]`).
</acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/sprint-artifacts/tech-spec-epic-1.md</path>
        <title>Epic Technical Specification: User Foundation &amp; Course Management</title>
        <section>AC 1.4: View Course List</section>
        <snippet>Dashboard displays a list of all courses belonging to the logged-in user. Dashboard does not display courses from other users. Clicking a course navigates to the course details page.</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Scale Adaptive Architecture</title>
        <section>4.1. Data Flow Pattern</section>
        <snippet>Frontend calls FastAPI Backend for ALL data (Notes, Courses, Quizzes). Frontend MUST include the Authorization: Bearer token header. Frontend never queries the Database directly.</snippet>
      </doc>
      <doc>
        <path>docs/PRD.md</path>
        <title>Product Requirements Document</title>
        <section>Functional Requirements</section>
        <snippet>FR002: Course Management: The system shall allow users to create and view courses.</snippet>
      </doc>
    </docs>
    <code>
      <item>
        <path>frontend/lib/api.ts</path>
        <kind>service</kind>
        <symbol>createCourse</symbol>
        <lines>18-36</lines>
        <reason>Existing API client to be extended with getCourses</reason>
      </item>
      <item>
        <path>backend/app/api/routers/courses.py</path>
        <kind>router</kind>
        <symbol>create_course</symbol>
        <lines>13-37</lines>
        <reason>Existing router to be extended with GET /courses endpoint</reason>
      </item>
    </code>
    <dependencies>
      <ecosystem name="npm">
        <package name="@supabase/supabase-js" version="^2.86.0" />
        <package name="@tanstack/react-query" version="^5.90.11" />
        <package name="lucide-react" version="^0.555.0" />
        <package name="next" version="16.0.5" />
      </ecosystem>
      <ecosystem name="pypi">
        <package name="fastapi" version=">=0.122.0" />
        <package name="pydantic" version=">=2.12.5" />
        <package name="supabase" version=">=2.24.0" />
      </ecosystem>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint>Frontend must use GET /api/v1/courses (No direct DB access)</constraint>
    <constraint>Backend must use get_current_user dependency for auth</constraint>
    <constraint>Row Level Security (RLS) must be verified for SELECT operations</constraint>
    <constraint>Type safety: Ensure Course interface in frontend matches Backend Pydantic model</constraint>
    <constraint>Use logging module in backend, not print()</constraint>
  </constraints>

  <interfaces>
    <interface>
      <name>GET /api/v1/courses</name>
      <kind>REST Endpoint</kind>
      <signature>GET /api/v1/courses -> { data: Course[] }</signature>
      <path>backend/app/api/routers/courses.py</path>
    </interface>
    <interface>
      <name>getCourses</name>
      <kind>Function Signature</kind>
      <signature>getCourses(): Promise&lt;Course[]&gt;</signature>
      <path>frontend/lib/api.ts</path>
    </interface>
  </interfaces>

  <tests>
    <standards>Backend tests use pytest with Supabase client mocking or local instance. Frontend tests are currently manual verification.</standards>
    <locations>
      <location>backend/tests/test_courses.py</location>
    </locations>
    <ideas>
      <idea id="AC 1.4.1">Test GET /courses returns list for auth user, empty list for new user, 401 for unauth.</idea>
    </ideas>
  </tests>
</story-context>
