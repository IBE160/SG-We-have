<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>4</epicId>
    <storyId>1</storyId>
    <title>Display Single Question</title>
    <status>drafted</status>
    <generatedAt>2025-12-04</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/epic-4/story-4-1-display-single-question/4-1-display-single-question.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>As a Student,</asA>
    <iWant>I want to see one quiz question at a time,</iWant>
    <soThat>so that I can focus on answering it without distraction.</soThat>
    <tasks>
- [ ] **Frontend - Component Creation:** Create `QuizQuestionDisplay` component to render a single question and its options. (AC: #1)
- [ ] **Frontend - API Integration:** Implement client-side logic to fetch the first question from `GET /api/v1/quiz/{quiz_id}/start`. (AC: #1)
- [ ] **Frontend - Navigation:** Implement "Next Question" button and its logic for navigating to the next question (initially, just to a placeholder). (AC: #2)
- [ ] **Backend - API Endpoint:** Implement `GET /api/v1/quiz/{quiz_id}/start` to fetch the initial quiz question data. (AC: #1)
- [ ] **Backend - Data Model:** Create Pydantic model for the quiz question display data. (AC: #1)
- [ ] **Test - Frontend:** Write unit tests for `QuizQuestionDisplay` component rendering. (AC: #1)
- [ ] **Test - Frontend:** Write integration tests for API call and rendering. (AC: #1, #2)
- [ ] **Test - Backend:** Write unit tests for the `GET /api/v1/quiz/{quiz_id}/start` endpoint. (AC: #1)
    </tasks>
  </story>

  <acceptanceCriteria>
1.  Quiz interface displays one question and its answer options clearly. (FR011)
2.  Navigation controls (e.g., "Next Question") are present.
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/PRD.md</path>
        <title>ibe160 Product Requirements Document (PRD)</title>
        <section>Functional Requirements</section>
        <snippet>FR011: Quiz Interface Display: The quiz interface shall display one question at a time. This is a core requirement for the interactive quiz experience, ensuring user focus.</snippet>
      </doc>
      <doc>
        <path>docs/PRD.md</path>
        <title>ibe160 Product Requirements Document (PRD)</title>
        <section>Non-Functional Requirements</section>
        <snippet>NFR005: Performance: The application shall be as performative as possible, ensuring a responsive user experience. This impacts how quickly questions load and navigate.</snippet>
      </doc>
      <doc>
        <path>docs/sprint-artifacts/tech-spec-epic-4.md</path>
        <title>Epic Technical Specification: Interactive Quiz Experience</title>
        <section>Objectives and Scope</section>
        <snippet>This epic focuses on delivering an engaging and feedback-rich interface for students... In-Scope: Displaying quiz questions one by one (FR011).</snippet>
      </doc>
      <doc>
        <path>docs/sprint-artifacts/tech-spec-epic-4.md</path>
        <title>Epic Technical Specification: Interactive Quiz Experience</title>
        <section>System Architecture Alignment</section>
        <snippet>This epic primarily impacts the frontend's `QuizPlayer` and `ScoreCard` components and the backend's `quiz_submission.py` service. It aligns with the Next.js frontend and FastAPI backend architecture.</snippet>
      </doc>
      <doc>
        <path>docs/sprint-artifacts/tech-spec-epic-4.md</path>
        <title>Epic Technical Specification: Interactive Quiz Experience</title>
        <section>Services and Modules</section>
        <snippet>Frontend (`frontend/app/quiz/*`, `frontend/components/*Quiz*`): `QuizPlayer` component: Manages display of single questions, answer selection, and navigation.</snippet>
      </doc>
      <doc>
        <path>docs/sprint-artifacts/tech-spec-epic-4.md</path>
        <title>Epic Technical Specification: Interactive Quiz Experience</title>
        <section>APIs and Interfaces</section>
        <snippet>`GET /api/v1/quiz/{quiz_id}/start`: Fetches the first question and initializes a quiz attempt. This is the entry point for displaying the first question.</snippet>
      </doc>
      <doc>
        <path>docs/sprint-artifacts/tech-spec-epic-4.md</path>
        <title>Epic Technical Specification: Interactive Quiz Experience</title>
        <section>Workflows and Sequencing</section>
        <snippet>Steps 2 & 3: Frontend calls `GET /api/v1/quiz/{quiz_id}/start`. Backend initializes `QuizAttempt` in DB. Frontend displays first question.</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Scale Adaptive Architecture: AI-Powered Student Helper</title>
        <section>Source Tree</section>
        <snippet>Project follows a Monorepo structure: `frontend/` for Next.js, `backend/` for FastAPI. Frontend components in `frontend/components/`, API logic in `backend/app/api/`.</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Scale Adaptive Architecture: AI-Powered Student Helper</title>
        <section>Data Flow Pattern (Frontend Auth + Backend Data)</section>
        <snippet>Frontend calls FastAPI Backend for ALL data (Notes, Courses, Quizzes). Frontend MUST include `Authorization: Bearer <token>` header in requests. Backend validates JWT.</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Scale Adaptive Architecture: AI-Powered Student Helper</title>
        <section>Naming Conventions</section>
        <snippet>API Endpoints: `kebab-case` (e.g., `/api/v1/generate-quiz`). TS/React Components: `PascalCase` (e.g., `QuizCard.tsx`). Python Variables/Files: `snake_case`.</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Scale Adaptive Architecture: AI-Powered Student Helper</title>
        <section>API Contract & Type Sharing</section>
        <snippet>When an agent modifies a Pydantic model in Backend (`schemas.py`), they MUST immediately update the corresponding TypeScript interface in Frontend (`types/api.ts`).</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Scale Adaptive Architecture: AI-Powered Student Helper</title>
        <section>Epic to Architecture Mapping</section>
        <snippet>Epic 4 (Quiz Experience) maps to Frontend: `QuizPlayer`, `ScoreCard` and Backend: `quiz_submission.py`.</snippet>
      </doc>
    </docs>
    <code>
      <artifact>
        <path>frontend/app/quiz/</path>
        <kind>directory</kind>
        <reason>New directory for quiz display, will contain page and potentially layout files.</reason>
      </artifact>
      <artifact>
        <path>frontend/components/QuizQuestionDisplay.tsx</path>
        <kind>component</kind>
        <reason>New React component to render a single question and its options as per AC #1.</reason>
      </artifact>
      <artifact>
        <path>frontend/lib/services/quiz.ts</path>
        <kind>service</kind>
        <reason>New client-side service for API calls related to quiz functionality, including fetching the first question.</reason>
      </artifact>
      <artifact>
        <path>backend/app/api/quiz.py</path>
        <kind>api_router</kind>
        <reason>Existing API router will be modified to add the new `GET /api/v1/quiz/{quiz_id}/start` endpoint.</reason>
      </artifact>
      <artifact>
        <path>backend/app/services/quiz_submission.py</path>
        <kind>service</kind>
        <reason>New backend service to handle quiz submission logic, including fetching quiz questions.</reason>
      </artifact>
      <artifact>
        <path>backend/app/models/quiz_submission.py</path>
        <kind>model</kind>
        <reason>New Pydantic models for quiz question display data and related entities.</reason>
      </artifact>
    </code>
    <dependencies>
      <frontend>
        <package name="@supabase/supabase-js" version="^2.86.0"/>
        <package name="@tanstack/react-query" version="^5.90.11"/>
        <package name="next" version="16.0.5"/>
        <package name="react" version="19.2.0"/>
        <package name="react-dom" version="19.2.0"/>
        <package name="zustand" version="^5.0.8"/>
        <package name="tailwind-merge" version="^3.4.0"/>
        <package name="clsx" version="^2.1.1"/>
        <package name="lucide-react" version="^0.555.0"/>
        <package name="typescript" version="^5" type="dev"/>
        <package name="tailwindcss" version="^4" type="dev"/>
        <package name="eslint" version="^9" type="dev"/>
        <package name="jest" version="^30.2.0" type="dev"/>
      </frontend>
      <backend>
        <package name="fastapi" version="^0.122.0"/>
        <package name="google-generativeai" version="^0.8.5"/>
        <package name="pydantic" version="^2.12.5"/>
        <package name="pydantic-ai" version="^1.26.0"/>
        <package name="supabase" version="^2.24.0"/>
        <package name="uvicorn" version="^0.38.0"/>
        <package name="python-dotenv" version="^1.2.1"/>
        <package name="python-jose" version="^3.5.0"/>
        <package name="httpx" version="^0.28.1"/>
        <package name="cryptography" version="^46.0.3"/>
        <package name="pytest" version="^9.0.1" type="dev"/>
        <package name="pytest-asyncio" version="^1.3.0" type="dev"/>
      </backend>
    </dependencies>

  </artifacts>

  <constraints>
    <constraint>
      <description>Data Flow Pattern (Frontend Auth + Backend Data): Frontend makes API calls to FastAPI Backend for all data. Frontend MUST include JWT. Backend validates JWT.</description>
      <source>docs/architecture.md#4.1.-Data-Flow-Pattern-(Frontend-Auth-+-Backend-Data)</source>
    </constraint>
    <constraint>
      <description>API Contract &amp; Type Sharing: Adhere to defined response/error formats. When Pydantic models change in Backend, update corresponding TypeScript interfaces in Frontend.</description>
      <source>docs/architecture.md#5.-API-Contract-&amp;-Type-Sharing</source>
    </constraint>
    <constraint>
      <description>Naming Conventions: Follow `kebab-case` for API endpoints, `snake_case` for Python, `PascalCase` for React components.</description>
      <source>docs/architecture.md#4.2.-Naming-Conventions</source>
    </constraint>
    <constraint>
      <description>Performance: Frontend quiz interactions (answer submission, next question load) should be highly responsive (&lt; 500ms).</description>
      <source>docs/sprint-artifacts/tech-spec-epic-4.md#Performance</source>
    </constraint>
  </constraints>
  <interfaces>
    <interface>
      <name>Get Initial Quiz Question</name>
      <kind>REST endpoint</kind>
      <signature>GET /api/v1/quiz/{quiz_id}/start</signature>
      <path>backend/app/api/quiz.py</path>
    </interface>
  </interfaces>
  <tests>
    <standards>
      <standard>Frontend: Use Jest for unit and integration testing of React components and API interactions.</standard>
      <standard>Backend: Use Pytest for unit and integration testing of FastAPI endpoints and service logic.</standard>
      <standard>Testing Pattern: Mock external dependencies (e.g., Supabase, external APIs) during unit tests.</standard>
      <standard>Integration Tests: Focus on interactions between frontend and backend, and backend with Supabase.</standard>
      <standard>E2E Tests: Cover full user journeys for critical paths (to be defined later).</standard>
    </standards>
    <locations>
      <location>frontend/tests/</location>
      <location>backend/tests/</location>
    </locations>
    <ideas>
      <idea ac_id="1">Unit test `QuizQuestionDisplay` component rendering with various question and option data.</idea>
      <idea ac_id="1">Unit test `GET /api/v1/quiz/{quiz_id}/start` endpoint to ensure it returns correct data structure and initializes attempt.</idea>
      <idea ac_id="1,2">Integration test client-side logic to fetch and display the first question, including navigation controls.</idea>
    </ideas>
  </tests>
</story-context>