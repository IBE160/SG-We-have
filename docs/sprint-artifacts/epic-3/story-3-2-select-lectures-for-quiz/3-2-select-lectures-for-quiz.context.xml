<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>3</epicId>
    <storyId>2</storyId>
    <title>Select Lectures for Quiz</title>
    <status>ready-for-dev</status>
    <generatedAt>2025-12-03</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/epic-3/story-3-2-select-lectures-for-quiz/3-2-select-lectures-for-quiz.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>student</asA>
    <iWant>to select specific lectures to include in a quiz</iWant>
    <soThat>I can focus on particular topics.</soThat>
    <tasks>
### Backend Tasks
- [ ] **Expose Note Status in Lecture API** (AC: 3.2.2)
  - Update `backend/app/models/lecture.py` (or schema) to include a `has_notes` boolean field (computed or joined).
  - Update `backend/app/api/lectures.py` to populate this field when listing lectures for a course.
  - Ensure efficient querying (avoid N+1 queries).

### Frontend Tasks
- [ ] **Update Api Client** (AC: 3.2.2)
  - Update `frontend/lib/api.ts` `Lecture` interface to include `has_notes`.
- [ ] **Enhance QuizConfigModal for Selection** (AC: 3.2.1)
  - Update `frontend/components/QuizConfigModal.tsx`.
  - Add prop: `lectures: Lecture[]`.
  - Render a list of lectures with checkboxes.
  - Implement state for `selectedLectureIds`.
  - Disable checkboxes where `lecture.has_notes` is false.
- [ ] **Implement Select All / Deselect All** (AC: 3.2.1)
  - Add a control to toggle selection of all *available* (valid) lectures.
- [ ] **Update Parent Integration** (AC: 3.2.1)
  - Update `frontend/app/dashboard/courses/[courseId]/page.tsx` to pass the course's lecture list to the modal.
  - Update `frontend/app/dashboard/courses/[courseId]/lectures/[lectureId]/page.tsx` to pass the current lecture (pre-selected) or full list.

### Testing Tasks
- [ ] **Backend Test: Lecture API**
  - Verify `GET /courses/{id}/lectures` returns `has_notes` correctly.
- [ ] **Component Test: QuizConfigModal Selection**
  - Verify list rendering.
  - Verify only lectures with notes are enabled.
  - Verify selection state updates.
  - Verify "Select All" behavior.
</tasks>
  </story>

  <acceptanceCriteria>
### AC 3.2.1: Lecture Selection Interface
- [ ] The quiz configuration modal displays a list of available lectures for the current course.
- [ ] Users can select one or more lectures using checkboxes.
- [ ] Users can "Select All" or "Deselect All" (usability enhancement).

### AC 3.2.2: Note Availability Constraint
- [ ] Only lectures that have associated saved notes are enabled for selection.
- [ ] Lectures without notes are visually distinct (e.g., grayed out) and unselectable.
- [ ] A tooltip or text explains why a lecture is unselectable (e.g., "No notes saved").
</acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/sprint-artifacts/tech-spec-epic-3.md</path>
        <title>Epic Technical Specification: AI-Powered Quiz Generation</title>
        <section>Detailed Design</section>
        <snippet>Configuration (Frontend - Stories 3.2, 3.3): Student selects lectures and desired quiz length within QuizConfigModal.</snippet>
      </doc>
      <doc>
        <path>docs/sprint-artifacts/tech-spec-epic-3.md</path>
        <title>Epic Technical Specification: AI-Powered Quiz Generation</title>
        <section>Acceptance Criteria (Authoritative)</section>
        <snippet>Story 3.2: Select Lectures for Quiz. 1. The quiz configuration interface allows the user to select one or more lectures from a displayed list. 2. Only lectures that have associated saved notes are presented as selectable options.</snippet>
      </doc>
      <doc>
        <path>docs/sprint-artifacts/tech-spec-epic-3.md</path>
        <title>Epic Technical Specification: AI-Powered Quiz Generation</title>
        <section>Traceability Mapping</section>
        <snippet>3.2.1 (Lecture Selection) | FR006 | QuizConfigModal.tsx, Backend quiz_service.py (for available notes) | Verify checkboxes/selection for lectures. 3.2.2 (Only Saved Notes) | FR006 | Backend quiz_service.py | Select lecture with no notes, verify it's disabled or not shown.</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Scale Adaptive Architecture: AI-Powered Student Helper</title>
        <section>Epic to Architecture Mapping</section>
        <snippet>Epic 3: AI Quiz Gen maps to Frontend Component `QuizConfigModal` and Backend Services `quiz_service.py`, `quiz_agent.py`.</snippet>
      </doc>
    </docs>
    <code>
      <item>
        <path>frontend/components/QuizConfigModal.tsx</path>
        <kind>component</kind>
        <symbol>QuizConfigModal</symbol>
        <lines>1-68</lines>
        <reason>Target component to enhance with lecture selection logic (AC 3.2.1).</reason>
      </item>
      <item>
        <path>frontend/app/dashboard/courses/[courseId]/page.tsx</path>
        <kind>page</kind>
        <symbol>CourseDetailsPage</symbol>
        <lines>1-138</lines>
        <reason>Parent page integration point for passing lecture list to the modal.</reason>
      </item>
      <item>
        <path>frontend/app/dashboard/courses/[courseId]/lectures/[lectureId]/page.tsx</path>
        <kind>page</kind>
        <symbol>LectureDetailsPage</symbol>
        <lines>1-117</lines>
        <reason>Parent page integration point for passing lecture list (or single lecture) to the modal.</reason>
      </item>
      <item>
        <path>frontend/lib/api.ts</path>
        <kind>api client</kind>
        <symbol>Lecture</symbol>
        <lines>1-160</lines>
        <reason>Interface definition to update with `has_notes` field (AC 3.2.2).</reason>
      </item>
      <item>
        <path>backend/app/api/lectures.py</path>
        <kind>api endpoint</kind>
        <symbol>get_lectures</symbol>
        <lines>1-50</lines>
        <reason>Backend endpoint to update to return `has_notes` status efficiently.</reason>
      </item>
      <item>
        <path>backend/app/models/lecture.py</path>
        <kind>pydantic model</kind>
        <symbol>Lecture</symbol>
        <lines>1-20</lines>
        <reason>Pydantic model to update with `has_notes` field.</reason>
      </item>
    </code>
    <dependencies>
      <ecosystem name="node">
        <package name="react" version="19.2.0" />
        <package name="lucide-react" version="^0.555.0" />
        <package name="clsx" version="^2.1.1" />
        <package name="tailwind-merge" version="^3.4.0" />
      </ecosystem>
      <ecosystem name="python">
        <package name="fastapi" version=">=0.122.0" />
        <package name="pydantic" version=">=2.12.5" />
        <package name="supabase" version=">=2.24.0" />
      </ecosystem>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint>
      <description>For `has_notes`, prefer a lightweight check. If using Supabase directly from backend, a `left join` or `exists` check is efficient.</description>
      <source>Dev Notes (3-2-select-lectures-for-quiz.md)</source>
    </constraint>
    <constraint>
      <description>The modal's open/close state is managed by the parent page. The *selection* state should likely be managed *inside* the modal, exposing the result via an `onGenerate(selectedIds)` callback.</description>
      <source>Dev Notes (3-2-select-lectures-for-quiz.md)</source>
    </constraint>
    <constraint>
      <description>Backend must avoid N+1 queries when populating `has_notes` for a list of lectures.</description>
      <source>Tasks (Backend Tasks)</source>
    </constraint>
  </constraints>

  <interfaces>
    <interface>
      <name>Lecture</name>
      <kind>TypeScript Interface</kind>
      <signature>interface Lecture { id: string; title: string; ... has_notes: boolean; }</signature>
      <path>frontend/lib/api.ts (Proposed)</path>
    </interface>
    <interface>
      <name>Lecture</name>
      <kind>Pydantic Model</kind>
      <signature>class Lecture(BaseModel): ... has_notes: bool</signature>
      <path>backend/app/models/lecture.py (Proposed)</path>
    </interface>
  </interfaces>

  <tests>
    <standards>
      <description>Use React Testing Library for frontend components. Verify list rendering, state updates, and disabled states. For backend, use Pytest to verify the API response includes the new field correctly.</description>
    </standards>
    <locations>
      <location>frontend/components/__tests__/</location>
      <location>backend/tests/</location>
    </locations>
    <ideas>
      <test id="AC 3.2.1">Verify modal renders list of lectures with checkboxes.</test>
      <test id="AC 3.2.1">Verify selecting a checkbox updates internal state.</test>
      <test id="AC 3.2.1">Verify "Select All" selects all enabled lectures.</test>
      <test id="AC 3.2.2">Verify checkboxes for lectures without notes are disabled.</test>
      <test id="Backend">Verify GET /lectures returns has_notes=true for lectures with content.</test>
      <test id="Backend">Verify GET /lectures returns has_notes=false for lectures without content.</test>
    </ideas>
  </tests>
</story-context>
