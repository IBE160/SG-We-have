<story-context id="docs/sprint-artifacts/epic-3/story-3-3/3-3-configure-quiz-length.context.xml" v="1.1">
  <metadata>
    <epicId>3</epicId>
    <storyId>3.3</storyId>
    <title>Configure Quiz Length</title>
    <status>ready-for-dev</status>
    <generatedAt>2025-12-03</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/epic-3/story-3-3/3-3-configure-quiz-length.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>Focused Fiona (Student)</asA>
    <iWant>to be able to choose the number of questions for my quiz (5, 10, 15, 20, 25, or 30)</iWant>
    <soThat>I can tailor the quiz to the time I have available and my current study needs</soThat>
    <tasks>
- [ ] **Frontend:** Update `frontend/components/QuizConfigModal.tsx` to include a selector (e.g., dropdown or radio buttons) for Quiz Length with values [5, 10, 15, 20, 25, 30]. Default to 10. (AC: 1, 2)
- [ ] **Frontend:** Update state management in `QuizConfigModal` to capture the selected length. (AC: 3)
- [ ] **Frontend:** Update `frontend/lib/api.ts` to include a `generateQuiz` function that accepts `lectureIds` (array) and `quizLength` (number). (AC: 3)
- [ ] **Backend:** Create `backend/app/api/routers/quiz.py` with a `POST /generate` endpoint (resulting in `/api/v1/quiz/generate`). (AC: 4)
- [ ] **Backend:** Define a Pydantic Request Model (e.g., `QuizGenerationRequest`) that includes `lecture_ids: List[str]` and `quiz_length: int`. (AC: 4)
- [ ] **Backend:** Wire up the `quiz` router in `backend/app/main.py`. (AC: 4)
- [ ] **Integration:** Verify that clicking "Generate" in the modal sends the correct JSON payload to the backend endpoint. (AC: 3, 4)
- [ ] **Testing:** Add unit tests for the Pydantic model validation (ensuring only 5-30 are accepted). (AC: 4)
    </tasks>
  </story>

  <acceptanceCriteria>
1.  The quiz configuration interface (`QuizConfigModal`) offers discrete options for quiz length: 5, 10, 15, 20, 25, or 30 questions.
2.  The default quiz length is set to 10 questions.
3.  The selected quiz length is included in the API request to the backend (`/api/v1/quiz/generate`).
4.  The Backend successfully receives the `quiz_length` parameter and validates it against the allowed values.
  </acceptanceCriteria>

  <artifacts>
    <docs>
        <doc path="docs/sprint-artifacts/tech-spec-epic-3.md" title="Epic 3 Tech Spec" section="Story 3.3: Configure Quiz Length" snippet="Provide options for selecting specific lectures and defining quiz length. Configurable Quiz Length (5, 10, 15, 20, 25, or 30 questions)." />
        <doc path="docs/PRD.md" title="Product Requirements Document" section="FR007: Configurable Quiz Length" snippet="Users can choose the number of questions (5, 10, 15, 20, 25, 30) before generating a quiz." />
        <doc path="docs/architecture.md" title="System Architecture" section="Detailed Design" snippet="Frontend talks directly to Supabase Auth. Backend queries Supabase DB or calls AI. Frontend never queries the Database directly." />
        <doc path="docs/design-specification.md" title="Design Specification" section="Form Elements" snippet="Inputs have a light border, rounded corners, and a blue focus ring. Labels are text-sm and font-medium." />
        <doc path="docs/epics.md" title="Epics" section="Epic 3" snippet="Core functionality: Quiz generation from lectures." />
        <doc path="docs/project-plan.md" title="Project Plan" section="Phase 4" snippet="Implementation of Quiz features." />
        <doc path="docs/sprint-artifacts/epic-3/story-3-2-select-lectures-for-quiz/3-2-select-lectures-for-quiz.md" title="Previous Story: Select Lectures" section="Learnings" snippet="Frontend/components/QuizConfigModal.tsx was significantly updated in 3.2 to handle lecture selection." />
    </docs>
    <code>
        <artifact path="frontend/components/QuizConfigModal.tsx" kind="component" symbol="QuizConfigModal" reason="Existing modal to be updated with length selector." />
        <artifact path="frontend/lib/api.ts" kind="client-api" symbol="generateQuiz" reason="New API function to be added." />
        <artifact path="backend/app/api/routers/quiz.py" kind="router" symbol="quiz_router" reason="New router to handle quiz generation requests." />
    </code>
    <dependencies>
        <dep key="frontend" name="react" version="19.2.0" />
        <dep key="backend" name="fastapi" version=">=0.122.0" />
        <dep key="backend" name="pydantic" version=">=2.12.5" />
    </dependencies>
  </artifacts>

  <constraints>
     <constraint>Quiz lengths must be strictly limited to: 5, 10, 15, 20, 25, 30.</constraint>
     <constraint>Default quiz length must be 10.</constraint>
     <constraint>Validation must be implemented on both Frontend (UI constraints) and Backend (Pydantic model validation).</constraint>
     <constraint>API Endpoint must follow project convention: POST /api/v1/quiz/generate</constraint>
  </constraints>

  <interfaces>
     <interface name="generateQuiz" kind="function signature" path="frontend/lib/api.ts" signature="export const generateQuiz = async (lectureIds: string[], quizLength: number): Promise<any>" />
     <interface name="POST /generate" kind="REST endpoint" path="backend/app/api/routers/quiz.py" signature="POST /api/v1/quiz/generate" />
     <interface name="QuizGenerationRequest" kind="Pydantic Model" path="backend/app/api/routers/quiz.py" signature="class QuizGenerationRequest(BaseModel): lecture_ids: List[str], quiz_length: Literal[5, 10, 15, 20, 25, 30]" />
  </interfaces>

  <tests>
    <standards>
        Frontend: Manual verification of modal state and network payload. 
        Backend: Unit tests for Pydantic model validation using pytest.
    </standards>
    <locations>backend/tests/test_quiz.py</locations>
    <ideas>
        <test>Verify default selection is 10 in UI.</test>
        <test>Verify allowed values [5, 10, 15, 20, 25, 30] are accepted by Pydantic model.</test>
        <test>Verify invalid values (e.g., 7, 100, -5) raise 422 Unprocessable Entity in backend.</test>
        <test>Verify API request payload contains correct keys: lecture_ids, quiz_length.</test>
    </ideas>
  </tests>
</story-context>