<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>3</epicId>
    <storyId>1</storyId>
    <title>Initiate Quiz Generation</title>
    <status>drafted</status>
    <generatedAt>2025-12-03</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/epic-3/story-3-1-initiate-quiz-generation/3-1-initiate-quiz-generation.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>student</asA>
    <iWant>to initiate quiz generation from my lecture notes</iWant>
    <soThat>I can create practice questions.</soThat>
    <tasks>
### Frontend Tasks
- [ ] **Create QuizConfigModal Component** (AC: 3.1.2)
  - Create `frontend/components/QuizConfigModal.tsx`.
  - Implement a basic modal shell (using shadcn/ui Dialog if available or custom).
  - Add props for `isOpen` and `onClose`.
  - Include a header title "Configure Quiz" and a close button.
- [ ] **Implement GenerateQuizButton** (AC: 3.1.1)
  - Create `frontend/components/GenerateQuizButton.tsx` (or use a standard Button with specific styling).
  - Ensure it accepts an `onClick` handler.
- [ ] **Integrate into Single Lecture Page** (AC: 3.1.1, 3.1.2)
  - Modify `frontend/app/dashboard/courses/[courseId]/lectures/[lectureId]/page.tsx`.
  - Add state `isQuizConfigOpen`.
  - Render `GenerateQuizButton` in the toolbar/header.
  - Render `QuizConfigModal` conditional on state.
- [ ] **Integrate into Course Overview Page** (AC: 3.1.1, 3.1.2)
  - Modify `frontend/app/dashboard/courses/[courseId]/page.tsx` (assuming this lists lectures).
  - Add "Generate Quiz" action/button for each lecture in the list.
  - Manage modal state (likely needing to track *which* lecture is being generated for).

### Testing Tasks
- [ ] **Component Test: QuizConfigModal**
  - Create `frontend/components/__tests__/QuizConfigModal.test.tsx`.
  - Test that it renders when `isOpen` is true.
  - Test that it calls `onClose` when close button is clicked.
- [ ] **Integration Test: Lecture Page**
  - Verify clicking the button sets state and opens modal.
</tasks>
  </story>

  <acceptanceCriteria>
### AC 3.1.1: Generate Quiz Button
- [ ] A "Generate Quiz" button is clearly visible on the single lecture page.
- [ ] A "Generate Quiz" button is clearly visible on the lecture notes overview page (Course details page).
- [ ] The button is disabled or hidden if no notes exist for the lecture (optional enhancement based on context).

### AC 3.1.2: Quiz Configuration Interface
- [ ] Clicking the "Generate Quiz" button opens a modal or overlay.
- [ ] The modal is titled "Configure Quiz" (or similar).
- [ ] The modal can be closed (cancel/close button).
</acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/sprint-artifacts/tech-spec-epic-3.md</path>
        <title>Epic Technical Specification: AI-Powered Quiz Generation</title>
        <section>Detailed Design</section>
        <snippet>User Action (Frontend - Story 3.1): Student clicks "Generate Quiz" on a lecture overview, opening QuizConfigModal. Configuration (Frontend - Stories 3.2, 3.3): Student selects lectures and desired quiz length within QuizConfigModal.</snippet>
      </doc>
      <doc>
        <path>docs/sprint-artifacts/tech-spec-epic-3.md</path>
        <title>Epic Technical Specification: AI-Powered Quiz Generation</title>
        <section>System Architecture Alignment</section>
        <snippet>Frontend Component: QuizConfigModal for user interaction. Backend Service: quiz_service.py, quiz_agent.py. AI Model: Google Gemini 2.5 Flash.</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Scale Adaptive Architecture: AI-Powered Student Helper</title>
        <section>6. Epic to Architecture Mapping</section>
        <snippet>Epic 3: AI Quiz Gen maps to Frontend Component `QuizConfigModal` and Backend Services `quiz_service.py`, `quiz_agent.py`.</snippet>
      </doc>
      <doc>
        <path>docs/PRD.md</path>
        <title>ibe160 Product Requirements Document (PRD)</title>
        <section>Functional Requirements</section>
        <snippet>FR019: Seamless Quiz Connection: The system shall provide clear "Generate Quiz" buttons on both single lecture page and lecture notes overview page.</snippet>
      </doc>
    </docs>
    <code>
      <item>
        <path>frontend/components/CreateLectureModal.tsx</path>
        <kind>component</kind>
        <symbol>CreateLectureModal</symbol>
        <lines>13-88</lines>
        <reason>Existing modal implementation to use as a reference pattern for `QuizConfigModal` (props, state handling, UI structure).</reason>
      </item>
      <item>
        <path>frontend/components/CreateCourseModal.tsx</path>
        <kind>component</kind>
        <symbol>CreateCourseModal</symbol>
        <lines>13-90</lines>
        <reason>Another modal example for consistency in styling and behavior.</reason>
      </item>
      <item>
        <path>frontend/app/dashboard/courses/[courseId]/lectures/[lectureId]/page.tsx</path>
        <kind>page</kind>
        <symbol>LecturePage</symbol>
        <lines>94-105</lines>
        <reason>Target page for the "Generate Quiz" button integration (Single Lecture view).</reason>
      </item>
      <item>
        <path>frontend/app/dashboard/courses/[courseId]/page.tsx</path>
        <kind>page</kind>
        <symbol>CoursePage</symbol>
        <lines>70-89</lines>
        <reason>Target page for the "Generate Quiz" button integration (Course Overview view).</reason>
      </item>
      <item>
        <path>frontend/components/NoteEditor.tsx</path>
        <kind>component</kind>
        <symbol>ToolbarButton</symbol>
        <lines>16-45</lines>
        <reason>Reusable button style or component used in the toolbar, relevant for consistency if placing the new button nearby.</reason>
      </item>
    </code>
    <dependencies>
      <ecosystem name="node">
        <package name="react" version="19.2.0" />
        <package name="lucide-react" version="^0.555.0" />
        <package name="@radix-ui/react-dialog" version="(check if available or use native/custom)" />
        <package name="clsx" version="^2.1.1" />
        <package name="tailwind-merge" version="^3.4.0" />
      </ecosystem>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint>
      <description>Modals should use a Portal or existing Dialog primitive to ensure they appear above other content.</description>
      <source>Dev Notes (3.1-initiate-quiz-generation.md)</source>
    </constraint>
    <constraint>
      <description>Lift state up to the Page level (`page.tsx`) to coordinate between the Button and the Modal.</description>
      <source>Dev Notes (3.1-initiate-quiz-generation.md)</source>
    </constraint>
    <constraint>
      <description>Ensure "Generate Quiz" buttons are consistent with existing UI (styling, placement).</description>
      <source>PRD (FR019)</source>
    </constraint>
  </constraints>

  <interfaces>
    <interface>
      <name>QuizConfigModalProps</name>
      <kind>Component Props</kind>
      <signature>interface QuizConfigModalProps { isOpen: boolean; onClose: () => void; }</signature>
      <path>frontend/components/QuizConfigModal.tsx (Proposed)</path>
    </interface>
  </interfaces>

  <tests>
    <standards>
      <description>Use React Testing Library for component tests. Verify rendering of modal when isOpen is true and onClose callback execution. Integration tests should verify state updates on button click.</description>
    </standards>
    <locations>
      <location>frontend/components/__tests__/</location>
    </locations>
    <ideas>
      <test id="AC 3.1.1">Verify "Generate Quiz" button is rendered on Lecture Page.</test>
      <test id="AC 3.1.2">Verify clicking button sets isOpen state to true.</test>
      <test id="AC 3.1.2">Verify Modal renders correctly when isOpen is true.</test>
      <test id="AC 3.1.2">Verify clicking Close button calls onClose handler.</test>
    </ideas>
  </tests>
</story-context>
